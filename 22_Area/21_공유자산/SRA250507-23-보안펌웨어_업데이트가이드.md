### 0. 사전작업
#### Python 설치 확인

```powershell

python --version
where.exe python

```

- 설치되어 있지 않으면 [python.org](https://www.python.org/)에서 설치해주세요.

#### esptool 설치 및 버전 확인
```powershell

python -m pip install esptool
esptool.exe version

```

- `esptool.exe version` 에서 에러가 난다면 
	- powershell > `Get-Command esptool.exe`
	- esptool.exe 위치확인 (예. C:\Users\insul\AppData\Local\....\Python313\Scripts\esptool.exe)
	- 찾기 > 고급 시스템 설정 보기 > 고급 > 환경변수 > 시스템 변수 > Path > 편집 > 새로만들기 > C:\Users\insul\AppData\Local\....\Python313\Scripts > 확인


### 1. PowerShell 열기
- 아래의 폴더를 선택하고 마우스 오른쪽 클릭 > 터미널에서 열기
- Staff > 10. 개발팀 > 02 Firmware > DB400
	- secure_espe32
	- secure_espe32s3
### 2. 첫 플래싱 (부트로더 · 파티션 · OTA · 앱)

1. 보드를 TTL로 연결 (COM2)
2. 펌웨어 다운로드 모드
	- DB300: JP1 점퍼핀으로 단락 후 전원 재인가하면 진입
	- DB400: SW1 누른 상태에서 SW2 눌렀다 떼고 SW1 떼면 진입
3. 아래의 명령어를 복사 -> powershell에 붙여넣기
4. 업데이트 완료
5. 전원 재인가


#### esp32: DB400S
```powershell
esptool.exe --chip esp32 --port COM2 --baud 921600 write_flash 0x1000  bootloader.bin 0x10000 partition-table.bin 0x11000 ota_data_initial.bin 0x20000 DIBD400S_08C_02R016C_V3.3.2.bin
```

#### esp32: DB400Q
```powershell
esptool.exe --chip esp32 --port COM2 --baud 921600 write_flash 0x1000  bootloader.bin 0x10000 partition-table.bin 0x11000 ota_data_initial.bin 0x20000 DIBD400Q_08C_02R006C_V3.2.8.bin
```

#### esp32: DB300eM
```powershell
esptool.exe --chip esp32 --port COM2 --baud 921600 write_flash 0x1000  bootloader.bin 0x10000 partition-table.bin 0x11000 ota_data_initial.bin 0x20000 DIBD300eM-V1.2.2-2x10.bin
  
```
#### esp32-s3: DB402S
```powershell
esptool.exe --chip esp32s3 --port COM2 --baud 921600 write_flash 0x1000  bootloader.bin 0x10000 partition-table.bin 0x11000 ota_data_initial.bin 0x20000 DIBD402S_08C_02R016C_V3.2.8.bin
```

- 위의 예시에서 
	- 펌웨어 파일이 변경되면 `0x20000 파일이름`으로 변경
	- 포트가 다르면 `--port 포트번호`로 변경
- 부트로더, 파티션 테이블, OTA 초기화 영역, 애플리케이션을 한 번에 기록
- 첫 부팅 시 ROM이 자동으로 bootloader digest를 계산하여 eFuse에 저장
- 이후 부트로더 영역은 보호되며, 앱만 OTA로 업데이트 가능

#### 3. 맥 어드레스 전송 및 표출문구 확인 (다빛채 > 메뉴모음 창)
- DB400S
	- 통신설정 > Client TCP/IP 통신 > IP: 192.168.0.201, Port: 5000 > 닫기
	- F10 > MacAddress 설정 > DABIT 600 > 전송
	- 아래의 항목을 자동전송
		- DIBD Screen Size
		- DIBD Display Size
		- Font
		- 실시간문구 전송
- DB402S
	- 통신설정 > Serial 통신 > 통신 포트 설정 > 닫기
	- F10 > MacAddress 설정 > DABIT 600 > 전송
	- 아래의 항목을 자동전송
		- DIBD Screen Size
		- DIBD Display Size
		- Font
		- 실시간문구 전송
- DB300eM
	- 통신설정 > Serial 통신 > 통신 포트 설정 > 닫기
	- F10 > MacAddress 설정 > DABIT 300 > 전송
	- DABITNet에서 네트워크 설정 확인



### 4. eFuse 상태 확인

```powershell

espefuse.exe --port COM2 --baud 115200 summary

```

- Secure Boot 및 Flash Encryption 관련 eFuse 비트 설정 상태를 점검

### 5. 앱(OTA) 업데이트


1. 보드를 TTL로 연결 (COM2)
2. 펌웨어 다운로드 모드
	- DB300: JP1 점퍼핀으로 단락 후 전원 재인가하면 진입
	- DB400: SW1 누른 상태에서 SW2 눌렀다 떼고 SW1 떼면 진입
3. 아래의 명령어를 복사 -> powershell에 붙여넣기
4. 업데이트 완료
5. 전원 재인가

#### esp32
```powershell
esptool.exe --chip esp32 --port COM2 --baud 921600 write_flash 0x20000 DIBD400S_08C_02R016C_V3.2.8.bin
```
```powershell

esptool.exe --chip esp32 --port COM2 --baud 921600 write_flash 0x20000 DIBD300eM-V1.2.2-2x10.bin
```

#### esp32-s3
```powershell
esptool.exe --chip esp32s3 --port COM2 --baud 921600 write_flash 0x20000 DIBD402S_08C_02R016C_V3.2.8.bin
```

- 위의 예시에서 
	- 펌웨어 파일이 변경되면 `0x20000 파일이름`으로 변경
	- 포트가 다르면 `--port 포트번호`로 변경
- 파티션 테이블과 OTA 데이터는 변경하지 않고, 애플리케이션만 갱신
- 부트로더 영역은 계속 보호됨
- DB300eM은 인터넷 URL입력창에 ip 주소를 입력해 web OTA로 펌웨어 업데이트 가능  

