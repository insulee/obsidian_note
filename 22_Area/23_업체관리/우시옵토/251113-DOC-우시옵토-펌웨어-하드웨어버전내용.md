# DABIT500s 하드웨어 및 펌웨어 버전 변경 내역

---
## 개요
- **하드웨어 버전**: V12.1 → V13
- **펌웨어 버전**: V2.4.1 → V3.3.5

---

## 하드웨어 버전별 변경 내용

### **PCB V13 (2024-11-29)**
- 이더넷 포트의 녹색과 황색 LED 램프의 신호라인을 상호 교체
- USB-C 포트의 CC라인에 1.5K옴 저항 추가


---

## 펌웨어 버전별 변경 내용


### **V3.4.3 (2025-11-14)**

- **기능 개선:**
	- 페이지 메시지(0x53)가 구형 프로토콜에서 표출되지 않는 문제를 해결


### **V3.3.5 (2025-09-09)**


- **기능 추가**
	- 표출 신호 매핑 프로토콜 `04D-P32D2S61` (138 IC) 추가.
	- **ASCii의 폰트 그룹 번호 인식 오류 수정**
	- **디버깅 통신포트 TTL로 통일**
	- 시프트라인 픽셀 개수 계산 시점을 바꿔 밝기값 오류를 수정
- **기능 개선**:
  - **ESP-IDF 버전 업그레이드**: V5.4.2로 업데이트.
  - **USB 안정성 향상**: USB 메모리 제거 시 시스템이 멈추는 현상을 수정하고, 인식률을 개선.
  - **화면 설정 옵션 추가**: '2줄 세로형' 및 '1줄 세로형 양면' 옵션 추가.
- **펌웨어 업데이트**: DB600T에서 이전 버전과의 펌웨어 업데이트 호환성 문제 해결.
- **표출 신호**: 구형 바이너리 표출 신호 매핑 프로토콜에서 색상 값이 변경되지 않던 문제 해결.



### **V3.2.8 (2025-06-04)**

- **기능 개선**:
  - **메모리 관리 최적화**:
    - `ParseNewProtocol`, `CreateDynamicPattern` 함수에 동적 할당 방식 도입.
    - 안전한 메모리 관리를 위한 메모리 해제 함수 추가.
    - `DisplayScreen` 함수 분리.
  - **메모리 사용량 감소**: 표출 신호 문자열 구조체 최적화를 통해 메모리 사용량 대폭 감소 (최적화 후 243바이트).
- **버그 수정 (DB600/DB500)**:
  - 보드 기능 설정에서 J4 Function을 DS1302로 선택 시 발생하던 RS-232 통신 오류 수정.
  - DS1302(RTC) 비활성화 시 초기 부팅이 지연되던 현상 해소.(참고: TTL 통신은 사용 불가)
- **개선 사항**:
  - **SDKConfig 환경설정 정리**: 공통 설정 및 보드별 설정 최적화.




### **V3.2.1 (2025-05-09)**

- **기능 개선**:
  - **ESP-IDF v5.4.1**로 업그레이드.
  - 부트로더 로그 레벨을 `Warning` 이상으로 조정하여 로그 간소화.
  - Flash SPI 속도를 **40 MHz (DIO)**로 통일.
  - esp32에서 리셋 후 TTL 포트로 초기 디버깅 로그를 출력하도록 변경.
  - 부트로더 패닉 딜레이를 **5초**로 설정.
  - **I2C API 마이그레이션** (`driver/i2c.h` → `driver/i2c_master.h`).
  - **실시간 프로토콜**: TCP 서버 중지 로직(`stop_tcp_server()`) 추가.
  - **시스템 구조**: 듀얼코어 태스크 구조 최종화.
  - **표출 효과**: 배경 이미지와 실시간 문구 효과 동시 표출 시 발생하던 이슈 해결 
  - **코드 표준화**: 매크로 명칭을 `USE_*`에서 `ENABLE_*`로 통일.
  - **분석**: "keros error" 발생 조건 및 빌드 옵션별 메모리 사용량 분석 완료.
  - **성능 최적화**: Flash SPI 속도를 40 MHz로 변경 (DB502 2x20열 최적화).
  - **메모리 최적화**: `IRAM_ATTR` 적용 함수를 해제하고, `dispTask_Core1` 태스크 선언 위치를 최적화.
  - **하드웨어 호환성**: 사용이 제한되는 핀에 대해 주석 처리.
  - **메모리 최적화**: IRAM 사용량 최적화를 위해 태스크 스택 조정.
  - **플래시 설정**: Flash SPI mode를 QIO에서 DIO로 전환.
- **기능 추가**:
  - **클럭 출력**: ESP32 50 MHz 클럭 출력 기능 추가 (RMII 외부 입력).



### **V3.1.4 (2025-02-20)**

- **기능 개선**:
  - **안정성**: 스케줄 파일(`schedule`) 손상 시, 파일을 초기화한 후 자동으로 리셋하도록 복구 처리 기능 개선.
  - **Heartbeat 기능**:
    - **설정 범위**: 0 ~ 999 (0: 사용 안 함, 1: 10초, 6: 1분 등)
    - **로직 개선**: PING 전송 간격이 10초일 때, PONG 응답 대기 시간이 5초여도 즉시 재전송되던 문제를 해결하여 정확한 주기로 동작하도록 수정.
  - **DB502 환경설정(sdkconfig) 정리**: 불필요한 항목을 제거하고 설정을 최적화.
  - **통신 채널 할당**: 기존에는 장치 수에 관계없이 통신 채널을 2개로 제한했으나, 장치 수와 채널 수를 동일하게 설정하여 모든 장치가 개별 채널로 통신할 수 있도록 변경.
  - **통신 포트 관리**: 물리 포트 수와 관계없이 동시 사용 가능한 메모리(채널)를 최대 2개로 제한. (물리 포트 0~4번을 2개의 논리 채널로 번갈아 할당)
    - **물리 포트**: 0: RS232, 1: TTL, 2: RS485, 3: TCP, 4: UDP
  - **하드웨어 지원**: DB500S/DB500T 모델의 섹션 수를 2개로 고정.
  - **초기화**: 하드웨어 초기화 시 디버깅 모드를 'Enable 3'으로 활성화.
  - **TCP 안정성**: 소프트웨어 리셋 시, TCP 전송 중인 경우 소켓 종료 신호를 먼저 보내도록 수정.
  - **Ethernet 성능**: Ethernet 인터럽트 우선순위를 시스템 콜과 동일하게 조정하여 패킷 처리 지연 감소.
  - **메모리 최적화**: `dns_server` 문자열 길이를 30에서 29바이트로 축소.
  - **초기화**: 하드웨어 리셋 시 네트워크 파라미터를 초기화하도록 변경.
  - **디버그 포트**: 디버그 포트 초기값을 RS232로 통일.
- **버그 수정**:
  - **GPS**: GPS 통신 오류 수정.
  - **프로토콜**: ASCII 프로토콜의 BCC 오류 수정.
  - **dbNet**: dbNet 프로토콜에서 장치 이름(`device_name`)이 잘못 표시되던 오류 수정.
  - **표출 효과**: "색상 깜박이기 전체(동시에)" 효과 표출 오류 수정.
  - **네트워크**: `.local_port`와 `.remote_port`를 동일한 값(5000)으로 설정 시, 클라이언트 모드에서 동작하지 않던 문제 해결.





### **V3.0.9 (2025-01-08)**

- **기능 추가**: ASCII 명령 추가.
  - `![0051!]`: 밝기 정보(%) 읽기.
  - `![0043!]`: 전광판 화면 구성(가로/세로 모듈 수, 배열 방식) 읽기.
  - `![0097!]`: 펌웨어 버전 및 CPU 속도(MHz) 읽기.
  - **폰트 축소 알고리즘 추가**:
    - 폰트 크기 1: 7x14 / 14x14
    - 폰트 크기 2: 6x12 / 12x12
  - **글자 간 픽셀 Offset 설정 명령 추가**: `![0058 1!]` (Offset 1픽셀)
- **버그 수정**:
  - **DB502**: 페이지 문구 전체 초기화 시 발생하던 오류 해결
  - 펌웨어 업데이트 시 저장되는 임시 영역이 배경 이미지 영역과 중복되어 발생하던 문제를 해결. (배경 이미지가 임시 영역 하단부터 저장되도록 수정)
- **기능 개선**:
  - **USB 안정성**: USB 메모리 삽입 상태를 보다 안정적으로 확인하도록 코드 보완.
  - **메모리 최적화**: 2단 이하 전광판의 섹션 수를 4개에서 2개로 변경하고, 텍스트 메시지 수를 2배로 증가시킴.
  - **Heartbeat 주기 초기화**: MAC 주소 설정시에는 Heartbeat 주기를 '사용 안 함(0)'으로 초기화하고, 공장 초기화 시에는 초기화하지 않도록 변경.
  - **서버 모드**: 논블로킹 방식으로 변경하여 성능을 최적화하고, 다중 클라이언트 연결을 지원. TCP 서버에서 Heartbeat 없이 효율적인 연결 유지 기능 추가.
  - **클라이언트 모드**: 논블로킹 방식으로 변경하여 데이터 처리 효율성을 향상시키고, Heartbeat 기능 추가.



### **V3.0.3 (2024-11-25)**

- **기능 추가**:
  - **USB 펌웨어 업데이트 기능**: USB에 펌웨어 파일을 저장하고 컨트롤러에 삽입하면 자동으로 업데이트 진행.
  - **Flash ROM 데이터 USB 전송 명령**: `![00E0!]` 명령으로 Flash ROM 데이터를 USB에 `.cpy` 확장자로 복사.
    - **복사 대상 파일**: param000, main_000, book_000, page_000, font_000, main_dat, main_ani, book_ani, book_dat
  - **폰트 두께 조절**: 폰트의 가로 및 세로 두께를 조절하는 기능 추가.
    - **패킷**: `![0058 000 001!]` (`000`: 가로 두께, `001`: 세로 두께)
- **개선 사항**:
  - **USB/SD 파일명 규칙 변경**: `main_000.pla` → `main_000.pla`, `nfont_00.fnt` → `font_000.fnt` 등.
  - **USB 스택 사이즈 변경**: 4096 → 5120으로 확대.
  - **USB 업데이트 절차 상세화**: Flash ROM 또는 USB를 통한 업데이트 절차 및 필요 파일 목록 정리.
  - **공장 초기화 특징**: 초기화 시 노란색 테두리 화면 표시, 메인 스케줄 및 일부 파라미터 초기화 (폰트, 배경 스케줄은 유지).
- **기능 개선**:
  - **폰트 렌더링**: 폰트 확대 알고리즘을 '이중선형 보간법'에서 '비정수 확대 알고리즘'으로 변경.
  - **TCP 서버 안정성**: 기존 클라이언트가 접속된 상태에서 새로운 연결이 시도될 경우, 시스템을 리셋하는 대신 모든 TCP 연결을 강제 종료하고 접속 대기 모드로 전환하도록 변경.




### **V2.6.7 (2024-11-13)**

- **기능 개선**:
  - **USB/SD 업데이트**: 컨트롤러 업데이트 시 `.bin` 형식의 파일만 지원하도록 변경.
  - **메모리 최적화**: ASCII 폰트 파일 전송에 사용되는 메모리 최적화 (1024 → 512 바이트).
  - **초기화 UI**: Factory Reset 시, 파라미터 파일 초기화 후 화면에 사각 테두리를 표시하도록 변경 (폰트 전송 후 사라짐).
  - **디버깅**: USB/SD 연결 시 파일명 확인을 위한 디버그 출력 추가.
  - **USB/SD 사용 시 안정성**: USB/SD 장착 시에도 LAN 파라미터와 MAC 주소를 Flash ROM에 저장하도록 수정 (`rx_0x87_0x38_2_WriteMac`).
  - **성능**: `scanWatchDog` 함수 실행 주기를 500ms에서 100ms로 변경.
  - **USB/SD 업데이트**: 컨트롤러 업데이트 시 파일 확장자가 `.bin` 형식인 경우에만 적용되도록 변경.
- **기능 추가**:
  - **데이터 백업**: Flash ROM 데이터를 USB/SD로 저장하는 명령 추가 (`![00E0!]`).
    - **생성 파일**: `dat_m001.bin`, `ani_m001.bin`, `ani_b001.bin`, `dat_b001.bin`
    - **적용 보드**: DB500/600 (DB502 미적용).
  - **소프트웨어 암호화 기능 추가** (V2.6.6 미만 버전과 호환성 유지).
  - **DB500/600 보안**: 소프트웨어 암호화 기능 추가 (`USE_MAINCPU_ENCRYPT` 매크로).




### **V2.6.3 (2024-11-01)**

- **기능 개선**:
  - **네트워크 안정성**: Ethernet 통신 중 트래픽이 심할 경우, Watchdog 주기를 단축하여 리셋 발생 최소화.
  - **USB 안정성**: DB500/600 보드에서 USB 메모리 제거 시 인식 문제 해결.
  - **동영상/텍스트 압축**: 압축 알고리즘 구현으로 전송 속도 개선 및 메모리 공간 확보.
  - **USB/SD 업데이트**: USB/SD를 이용해 컨트롤러의 스케줄 및 사용자 펌웨어 업데이트 기능 구현.
- **버그 수정**:
  - **스케줄 효과**: 입장 및 퇴장 효과가 모두 '오른쪽으로 이동'일 경우, 첫 프레임과 마지막 프레임이 순서대로 표시되도록 수정 (V2.5.3 변경 사항 원복).
  - **스케줄 안정성**: 메인 스케줄 손상 시 화면이 표시되지 않던 문제 해결.
- **기능 추가**:
  - **폰트 스케일링**: ASCII/한글 조합형/유니코드 16, 32픽셀 폰트의 확대/축소 기능 구현.
    - **보간값 설정 규칙**:
      - 0: 보간 미적용 (이동 효과 자연스러움).
      - 1~9: 10% 단위 보간 적용 (프레임 멈칫 현상 발생 가능).
    - **권장 사항**: 32~64픽셀 확장 폰트의 경우, 32픽셀 원본 폰트 사용 권장.



### **V2.5.3 (2024-09-12)**

- **기능 개선**:
  - **스케줄 효과**: 입장 및 퇴장 효과가 모두 '오른쪽으로 이동'일 경우, 마지막 프레임부터 첫 번째 프레임 순서로 화면에 표시되도록 변경
  - DB600V 펌웨어에 RS485 기능 활성화.
  - '청색 글자/배경 깜박임'을 '노란색 글자/배경 깜박임'으로 변경.
  - 모듈 배열 방식이 '2줄 세로형'일 때, Y축 모듈 수가 홀수인 경우도 처리 가능하도록 개선.
- **기능 추가**:
  - **점멸 효과 횟수 설정 명령 추가**:
    - **설정 규칙**: 0 또는 21 이상은 기본값 8회, 1~20은 해당 값으로 설정.
    - **전송 패킷**: `![0055 20!]` (20회 점멸)
    - **응답 패킷**: `![00540!]` (성공), `![0054F!]` (실패)
  - **배경 스케줄 목록 작성 프로토콜 추가**:
    - **전송 패킷**: `![0020abc def ghi!]` (abc, def, ghi는 표출할 배경 이미지 파일 번호)
    - **응답 패킷**: `![00200!]` (성공), `![0020F!]` (실패)
  - **전광판 스케줄 표출 속도 변경 명령 추가**:
    - **속도 설정**: 0 (스케줄 기본값 적용), 1(가장 빠름) ~ 99(가장 느림).
    - **전송 패킷**: `![0054 99!]`
    - **응답 패킷**: `![00540!]` (성공), `![0054F!]` (실패)
  - **'적색 깜박이며 좌로 이동하기' 효과 구현**.
- **하드웨어 지원**: 신형 P10 모듈의 팬아웃 부족 문제 해결.
  - **기존**: 1, 2단 HUB75 동시 연결.
  - **변경**: 1, 3단 HUB75를 사용하도록 변경하여 표출 불량 문제 해결.
- **버그 수정**:
  - **프로토콜**: ASCII 프로토콜에서 BCC Check 바이트 선택 시 계산 오류 수정.
  - **DB502**: 접점 입력을 BCD로 설정했을 때, 5번째 접점 입력(값 10)이 20으로 잘못 계산되던 문제 수정.

