### 성화기술산업 전광판 구성 및 리셋 상황

- 전광판 구성과 데이터 전송 및 표출은 다음의 순서로 진행
	1. 성화터치패널: 패널내의 버튼으로 전광판, 경광등, 싸이렌 등을 제어
	2. 마이컴: RELAY로 컨트롤러의 전원을 ON/OFF하고, 설정 및 문구표출 관련 패킷 전송
	3. 다빛솔루션 컨트롤러: 전달받은 패킷을 LED 모듈에 표출
- 컨트롤러 리셋 상황
	- 성화터치패널에서 교통통제중 등 **문구표출버튼**을 눌러 좌/우측 화살표 이동효과 중
	- **꺼짐버튼**을 누르고 다시 **문구표출버튼**을 눌렀을 때 (최소 6회 이상 반복) 컨트롤러 초기화

---
### 원인 분석

#### RELAY OFF: 플래시 메모리에 쓰기 동작과 전원 차단이 겹침
- 전광판 컨트롤러의 펌웨어는 FreeRTOS 상에서 동작하여 여러 태스크들의 실행 시점이 스케줄링에 따라 결정되어, 그 실행 시점은 일정하지 않아 예측하기 어려움
- 꺼짐버튼을 누르는 시점과 플래시 메모리에 쓰기 동작이 겹친다면, 즉 플래시에 쓰기 작업 도중 전원이 차단되면 플래시 메모리 손상으로 인해 컨트롤러가 리셋되는 것으로 추측
- 현재 **꺼짐버튼**은 전광판 설정 또는 표출 중에 바로 컨트롤러의 전원을 차단하는 방식으로,
- 컴퓨터를 끌 때 전원 플러그를 바로 뽑지 않고 정상적인 시스템 종료 절차를 거쳐 끄는 방식과 유사하게 꺼짐버튼을 동작하도록 수정하거나, 설정 관련 명령을 플래시 메모리 대신 RAM에 저장하는 방식으로 수정할 것을 권장

---
### 해결책 제안

#### 제안1: 꺼짐버튼을 눌렀을 때 안정적인 종료 프로세스 설정
1. **꺼짐버튼**을 눌렀을 때, 바로 RELAY OFF하여 컨트롤러의 전원을 차단하지 않고
2. 컨트롤러 화면 끄기 패킷 `![00210!]` 전송 
3. 수신패킷 `![00210!]`을 받고 RELAY OFF

 #### 제안2: RTC 검색 과정을 제거하고, 플래시 기록 방식이 변경된 펌웨어 적용
- 컨트롤러 초기 부팅중 RTC를 검색하는 과정을 제거해 부팅 완료 시간 단축
- 플래시 메모리에 쓰기와 전원 차단이 겹쳐 플래시 메모리가 손상되는 상황을 막기 위해 밝기제어, 표출속도 등의 명령을 플래시 메모리에 저장하는 대신 RAM에 저장하는 방식으로 수정
	- 밝기 제어
		- 전송 패킷 :
			- 플래시 메모리에 저장: `![005099!]`
			- RAM에 저장: `![0050991!]` (기존 패킷 마지막에 1을 추가)
		- 응답 패킷 :
			- `![00500!]`: 전송성공 (플래시, RAM 동일)
			- `![0050F!]`: 전송실패 (플래시, RAM 동일)
	- 표출 속도 
		- 전송 패킷 :
			- 플래시 메모리에 저장: `![0054 50!]`
			- RAM에 저장: `![0054 501!]` (기존 패킷 마지막에 1을 추가)
		- 응답 패킷 :
			- `![00540!]`: 전송성공 (플래시, RAM 동일)
			- `![0054F!]`: 전송실패 (플래시, RAM 동일)
- 수정 펌웨어
	- `DIBD500S_08C_02R020C_V3.1.4(BL V8.0)-UM-NoRTC.bin`
	- `DIBD600T_08C_04R020C_V3.1.4(BL V8.0)-UM-NoRTC.bin`