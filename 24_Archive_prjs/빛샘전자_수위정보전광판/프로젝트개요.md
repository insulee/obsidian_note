## 수위정보 전광판 구성 및 작동 방식

---

### 1. 시스템 개요
- **구성 요소**  
	- 데이터로거(서버)  
	- 전광판(클라이언트)  
- **통신 방식**: TCP/IP 기반, 1분 간격 주기 통신  
- **역할 분담**  
	- 데이터로거(서버): 수위 센서(또는 가상 데이터)로부터 수위 정보를 취득하여 전광판 요청 시 응답  
	- 전광판(클라이언트): 데이터로거에 일정 주기로 접속하여 수위값 요청, 수신된 데이터 표출
- ![[prj_빛샘수위5.png|500]]  

이렇게 전광판이 계속해서 데이터로거에 정보를 요구하고, 데이터로거가 해당 정보를 전달함으로써 실시간 수위 표시와 알람 상태 관리를 가능케 함

---

### 2. 하드웨어 및 네트워크 환경
- **데이터로거 원격 접속 정보**
	- IP: `121.137.95.37`
	- Port: `20001`
- **테스트 시나리오**: 실제 수위 센서가 연결되지 않은 상태이므로, 가상의 6개 값을 보통/경고/위험 레벨에 맞춰 순환적으로 응답  
- **예시 패킷**:  
	- `02 00 01 00 01 00 03`
	- `02 80 01 00 0C 07 E8 09 0A 01 13 21 02 BC 02 58 00 03`
	- `02 80 01 00 0C 07 E8 09 0A 01 13 35 03 20 02 58 01 03`
	- `02 80 01 00 0C 07 E8 09 0A 01 13 37 03 52 02 58 01 03`
	- `02 80 01 00 0C 07 E8 09 0A 01 14 00 04 4C 02 58 02 03`
	- `02 80 01 00 0C 07 E8 09 0A 01 14 06 02 8A 02 58 00 03`

---

### 3. 통신 프로토콜 상세
- 전광판 → 데이터로거의 **수위 정보 요청**
- 데이터로거 → 전광판의 **수위 정보 응답**으로 구성
#### 3.1 수위 정보 요청 (전광판 → 데이터로거)
`STX(02h) CMD(0001h) LEN(0001h) Data(00h) ETX(03h)`

- 예시: `02 00 01 00 01 00 03`
- `CMD(0001h)` → 수위 요청을 의미  
- `LEN(0001h)` → 데이터 길이가 1바이트임  
- 실제 Data는 `00h`로 고정(더미)

#### 3.2 수위 정보 응답 (데이터로거 → 전광판)
`STX(02h) CMD(8001h) LEN(000Ch) [Data(12Byte)] ETX(03h)`
- 예시: `02 80 01 00 0C 07 E8 09 0A 01 13 21 02 BC 02 58 00 03`
- **Data(12바이트) 항목**  
  1) Year(2Byte) - 2000~2099 기준  
  2) Month(1Byte)  
  3) Day(1Byte)  
  4) Hour(1Byte)  
  5) Minute(1Byte)  
  6) Second(1Byte)  
  7) 현재수위(2Byte) - 소수점 둘째자리까지 x 100  
  8) 기준수위(2Byte) - 소수점 둘째자리까지 x 100  
  9) 수위알람레벨(1Byte) - (0: 보통 / 1: 경고 / 2: 위험)

---

### 4. 전광판 화면 표출 방식
1. **현재수위, 기준수위, 상태** 세 정보 표출  
2. **소수점 두 자리**까지 표현(m 단위)  
3. **알람 레벨별 표시**  
   - 보통(00h): SIAP(녹색)  
   - 경고(01h): SIAGA(노란색)
   - 위험(02h): AWAS(빨간색, 깜박임)  
4. **기준 수위**는 고정 녹색 처리  
5. **1분 주기**로 전광판이 데이터로거 재요청 후 수위 데이터 갱신

---

